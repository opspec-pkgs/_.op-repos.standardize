name: github.com/opspec-pkgs/_.pkg-repos.standardize
description: Internal pkg for opspec-pkgs/maintainers which iterates over, and standardizes, all pkg repos.
version: 1.0.0
inputs:
  githubEmailAddress:
    string:
      constraints: { minLength: 1 }
      description: github email address to authenticate with
  githubAccessToken:
    string:
      constraints: { minLength: 1 }
      description: access token to authenticate with; see https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/
      isSecret: true
  srcDir:
    dir:
      default: ..
run:
  serial:
    - op:
        pkg: { ref: github.com/opspec-pkgs/github.organization.repos.list#1.0.0 }
        inputs:
          accessToken: $(githubAccessToken)
          org: opspec-pkgs
        outputs:
          repos:
    - container:
        image: { ref: 'node:9.5.0-alpine' }
        cmd: [node, /cmd.js]
        files:
          /cmd.js:
          /repos: $(repos)
          /repoNames: $(repoNames)
    - container:
        image: { ref: 'opctl/opctl:beta' }
        cmd: [ /cmd.sh ]
        envVars:
          githubEmailAddress:
          githubAccessToken:
        dirs:
          /srcDir: $(srcDir)
          /standardize-repo:
        files:
          /repoNames: $(repoNames)
          /cmd.sh:
        workDir: /srcDir